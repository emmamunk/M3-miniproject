---
title: "M3-project"
date: "24 nov 2019"
output:
  html_document:
    code_folding: hide
    df_print: paged
    number_sections: yes
    toc: yes
    toc_float: yes
  pdf_document:
    toc: yes
---
# Introduction

# Problem

# Data desciption

# Data preprocessing 

## Load libaries

We start by cleaning the environment.

```{r, include=FALSE}
#Cleaning the environment
rm(list=ls())
```

And then we'll import Keras, which is essential for the anaysis. You have to use "install_keras" if you're installing Keras for the first time.

```{r}
#devtools::install_github("rstudio/keras", force = TRUE)
#library(keras)
#install_keras()
```

And then we'll load a bunch of other packages.

```{r}
#Loading packages
if (!require("pacman")) install.packages("pacman")
pacman::p_load(knitr,
               readr,
               rmarkdown, 
               tidyverse,
               dplyr,
               broom,
               keras,
               drat,
               reticulate,
               SciencesPo,
               caret,
               textstem,
               recipes
               )
```

## Data

And now we can download the data from the Github.

```{r}
listings <- read_csv("C:/Users/Michael Thomsen/Desktop/Stockholm/listings.csv")
reviews <- read_csv("C:/Users/Michael Thomsen/Desktop/Stockholm/reviews_detailed.csv")

```

```{r}
listings = read_csv("C:/Users/Emma/OneDrive/Universitetet/stockholm-sweden-airbnb-listings/listings_detailed.csv")

reviews = read_csv("C:/Users/Emma/OneDrive/Universitetet/stockholm-sweden-airbnb-listings/reviews_detailed.csv")
```

## Data preprocessing

In the variable listings, there's a lof of variables. We have choosen some of them, including id, neighbourhood, room type, minimum nights, number of reviews, reviews per month, calculated host listings count and availability 365.

```{r}
listings = listings %>% select(c(monthly_price, neighbourhood, minimum_nights, accommodates, bathrooms, bedrooms, beds, number_of_reviews, guests_included, review_scores_rating, availability_365))
```


And then we'll remove NA's.

```{r}
listings = na.omit(listings)
```

After removing NA's, we're down to 6273 observationsa and eight variables. Now, we'll remove every listing, where availability is equal to zero. 

```{r}
listings$monthly_price = as.numeric(gsub('[$,]', '', listings$monthly_price))
```

```{r}
listings
```

# Supervised machine learning

We'll start by splitting the data into test and training.

```{r}
index = createDataPartition(y = listings$monthly_price, p = 0.75, list = FALSE)

training = listings[index,] 
test = listings[-index,] 
```



```{r}
reci <- recipe(monthly_price ~ ., data = training) %>%
  step_center(all_numeric(), -all_outcomes()) %>% 
  step_scale(all_numeric(), -all_outcomes()) %>% 
  step_zv(all_predictors())

reci = reci %>% step_knnimpute(all_predictors()) 

reci = reci %>% prep(data = training)
```

```{r}
reci
```

```{r}
x_train = bake(reci, new_data = training) %>% select(-monthly_price) 
y_train = training %>% pull(monthly_price)

x_test = bake(reci, new_data = test) %>% select(-monthly_price) 
y_test =  test %>% pull(monthly_price)
```

```{r}
ctrl = trainControl(method = "cv", 
                     number = 10)
```

```{r}
fit_lm <- train(x = x_train, 
                y = y_train, 
                trControl = ctrl, 
                method = "glm",
                family = "gaussian")
```

```{r}
fit_lm %>% summary()
```

```{r}
fit_lm
```

```{r}
tune_glmnet = expand.grid(alpha = seq(0, 1, length = 5), lambda = seq(0, 1, length = 5))
tune_glmnet
```

```{r}
fit_glmnet <- train(x = x_train, 
                    y = y_train, 
                    trControl = ctrl, 
                    method = "glmnet", family = "gaussian", 
                    tuneGrid = tune_glmnet)
```

```{r}
fit_glmnet
```
```{r}
pred_lm = predict(fit_lm, newdata = x_test) 
pred_glmnet <- predict(fit_glmnet, newdata = x_test) 

# RMSE OLS
sqrt(mean( (y_test - predict(fit_lm, newdata = x_test) ) ^ 2))
```

```{r}
sqrt(mean( (y_test - predict(fit_glmnet, newdata = x_test) ) ^ 2))
```


































############################STOP HER EMMA!!!!!!!!!!!!!!!!!!!!!!####################################
Data preprocessing NLP
```{r}

```

